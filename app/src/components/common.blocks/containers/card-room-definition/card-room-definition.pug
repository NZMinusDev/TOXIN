include ~@common.blocks/primitives/form-dropdown/form-dropdown.pug
include ~@common.blocks/primitives/button/button.pug

//- class: class for component bem mix: such as positioning functionality
//- name: {string} - name of <form>, also it is used such prefix for names of inner forms
//- action: form action
//- method: form method - default is 'get'
//- roomNumber: {number} - number of room
//- roomGrade: {string} - grade of room
//- paymentAmount: {number} - daily cost
//- selectedDates?: {ISODateString,ISODateString} - initial dates; example: "2020-11-18T21:00:00.000Z,2020-11-20T21:00:00.000Z";
//- guestsGroups: {'group-name-1':{selectionText: string, textPlural: string},'group-name-2':selectionText: string, textPlural: string,...}, example: { guests: { selectionText: 'гость', textPlural: 'гостя' }, младенцы: { selectionText: 'младенец', textPlural: 'младенцев' } }
//- guestsList: {''Item title 1'': {default: number, min: number, max: number, group?: 'group-name-2'},''Item title 2'': {default: number, min: number, max: number, group?: 'group-name-1'},...}, example:{ взрослые: { default: 0, min: 0, max: 1 / 0, group: 'гости' }, дети: { default: 0, min: 0, max: 1 / 0, group: 'гости' }, младенцы: { default: 0, min: 0, max: 1 / 0} }; - if group is unset the itemName will be used instead 
//- servicesPayment: {number} - amount of services payment
//- servicesSale: {number} - amount of services sale
//- additionalServicesPayment: {number} - amount of additional services payment
mixin card-room-definition({ roomNumber = -1, roomGrade = '', paymentAmount = -1, selectedDates = '', guestsGroups = {}, guestsList = {}, servicesPayment = -1, servicesSale = -1, additionalServicesPayment = -1, name = 'card-room-definition', action = '/mock.js', method = 'post' } = {})
  -
    const currency = '₽';

    const roomNumberSentence = `№ ${roomNumber.toLocaleString()}`;
    const paymentAmountSentence = `${paymentAmount.toLocaleString()}${currency}<span class="card-base__text card-base__text_size-small"> в сутки</span>`;

    servicesPayment = servicesPayment - servicesSale;
    const servicesSaleSentence = servicesSale
      ? `скидка ${servicesSale.toLocaleString()}${currency}`
      : '';
  form.card-base.card-room-definition(name=name, action=action, method=method)&attributes(attributes)
    .card-room-definition__room-title
      h1.card-room-definition__room-number= roomNumberSentence
      h3.card-room-definition__room-grade= roomGrade
    h3.card-room-definition__day-payment(data-amount=paymentAmount)!= paymentAmountSentence
    +form-dropdown('date', { heading: { h3: 'Прибытие' }, name: `${name}-arrival`, output: 'plural', selectedDates, altFields: `.card-room-definition__departure-date-dropdown [name=${name}-departure]`}).card-room-definition__arrival-date-dropdown
    +form-dropdown('date',{ heading: { h3: 'Выезд' }, name: `${name}-departure`, isAltField: true}).card-room-definition__departure-date-dropdown
    +form-dropdown('item-quantity',{ name: `${name}-guests`, heading: { h3: 'Гости' }, placeholder: 'Сколько гостей', openMod: 'apply', groups: guestsGroups, list: guestsList}).card-room-definition__guests-single-apply
    .card-room-definition__payment-rates
      p.card-room-definition__payment-item.card-room-definition__total-day-payment
        span.card-room-definition__payment-sentence
        span.card-room-definition__payment-amount
      p.card-room-definition__payment-item.card-room-definition__services-payment
        span.card-room-definition__payment-sentence= `Сбор за услуги: ${servicesSaleSentence}`
          span.tooltip.card-room-definition__payment-tooltip(
            data-content="Подсказка к сборам за услуги"
          ) i
        span.card-room-definition__payment-amount(data-amount=servicesPayment)= `${servicesPayment.toLocaleString()}${currency}`
      p.card-room-definition__payment-item.card-room-definition__additional-services-payment
        span.card-room-definition__payment-sentence Сбор за дополнительные услуги
          span.tooltip.card-room-definition__payment-tooltip(
            data-content="Подсказка к сборам за дополнительные услуги"
          ) i
        span.card-room-definition__payment-amount(data-amount=additionalServicesPayment)= `${additionalServicesPayment.toLocaleString()}${currency}`
    h2.card-room-definition__payment-item.card-room-definition__total-payment
      span Итого
      .text-separator
      span.card-room-definition__total-payment-amount
    +button({ mod: 'link' }).card-room-definition__submit-btn(
      type="submit",
      value="Забронировать"
    )
